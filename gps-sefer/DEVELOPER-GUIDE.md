# üöõ GPS Sefer Takip Sistemi - Kapsamlƒ± Geli≈ütirici Rehberi

## üìã ƒ∞√ßindekiler
1. [Proje Genel Bakƒ±≈ü](#proje-genel-bakƒ±≈ü)
2. [Sistem Mimarisi](#sistem-mimarisi)
3. [Backend Entegrasyonu](#backend-entegrasyonu)
4. [Teknik Altyapƒ±](#teknik-altyapƒ±)
5. [Kurulum ve Yapƒ±landƒ±rma](#kurulum-ve-yapƒ±landƒ±rma)
6. [API Dok√ºmantasyonu](#api-dok√ºmantasyonu)
7. [Mobil Uygulama](#mobil-uygulama)
8. [Deployment Rehberi](#deployment-rehberi)
9. [Troubleshooting](#troubleshooting)

---

## üéØ Proje Genel Bakƒ±≈ü

### Program Nedir?
**GPS Sefer Takip Sistemi**, ≈üof√∂rlerin ara√ß takip ve sefer y√∂netimini saƒülayan React Native tabanlƒ± bir mobil uygulamadƒ±r. Sistem, **dual-Supabase mimarisi** ile √ßalƒ±≈üƒ±r ve ger√ßek zamanlƒ± konum takibi, g√∂rev y√∂netimi ve backend entegrasyonu saƒülar.

**CRITICAL UPDATE**: Both backends are Supabase-based projects, not PHP/Laravel as initially assumed.

### Ama√ß
- **≈ûof√∂r Perspektifi**: Mobil uygulamada g√∂revleri g√∂rme, onaylama/reddetme, GPS takibi yapma
- **Admin Perspektifi**: ≈ûof√∂r atama, g√∂rev durumu takibi, rota analizi
- **M√º≈üteri Perspektifi**: Kargo durumu ve konum takibi
- **Sistem Entegrasyonu**: Mevcut kargo y√∂netim sistemi (kargomarketing.com Supabase) ile entegrasyon

### Hedef Kullanƒ±cƒ±lar
- üöõ **≈ûof√∂rler**: GPS takibi, g√∂rev onayƒ±, sefer y√∂netimi
- üë®‚Äçüíº **Dispatch/Admin**: ≈ûof√∂r atama, rota planlama, takip
- üì¶ **M√º≈üteriler**: Kargo durumu sorgulama
- üè¢ **Sistem Entegrat√∂r√º**: API √ºzerinden otomatik g√∂rev aktarƒ±mƒ±

---

## üèóÔ∏è Sistem Mimarisi

### Dual Supabase Backend Mimarisi

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              DUAL SUPABASE BACKEND ARCHITECTURE                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ   SUPABASE #1       ‚îÇ  Edge   ‚îÇ      SUPABASE #2         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ (kargomarketing.com)‚îÇFunctions‚îÇ    (GPS System)          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ ƒ∞lan Y√∂netimi     ‚îÇ         ‚îÇ ‚Ä¢ GPS Tracking           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ M√º≈üteri Bilgileri ‚îÇ         ‚îÇ ‚Ä¢ ≈ûof√∂r Y√∂netimi         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Teklif Sistemi    ‚îÇ         ‚îÇ ‚Ä¢ Sefer Takibi          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Kargo Detaylarƒ±   ‚îÇ         ‚îÇ ‚Ä¢ Mobil App Backend     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ           ‚îÇ                                   ‚ñ≤                 ‚îÇ
‚îÇ           ‚îÇ ilan_no                          ‚îÇ                 ‚îÇ
‚îÇ           ‚îÇ (Primary Key)                    ‚îÇ                 ‚îÇ
‚îÇ           ‚ñº                                  ‚îÇ                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ              EDGE FUNCTIONS (API Gateway)              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ create-job  ‚îÇ assign-driver ‚îÇ get-tracking ‚îÇ driver-approve ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                              ‚ñ≤                                 ‚îÇ
‚îÇ                              ‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ                MOBILE APP (React Native)               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ GPS Tracking     ‚Ä¢ Task Management                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Authentication   ‚Ä¢ Real-time Updates                 ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Sorumluluklar Daƒüƒ±lƒ±mƒ±

#### Supabase #1 (kargomarketing.com)

- ‚úÖ **ƒ∞lan Y√∂netimi**: Kargo ilanlarƒ±, teklifler, fiyatlandƒ±rma
- ‚úÖ **M√º≈üteri ƒ∞li≈ükileri**: M√º≈üteri bilgileri, sipari≈ü y√∂netimi
- ‚úÖ **ƒ∞≈ü S√ºreci Y√∂netimi**: Teklif onayƒ±, √∂deme, faturalandƒ±rma
- ‚úÖ **Raporlama**: ƒ∞≈ü analizi, gelir takibi

#### Supabase #2 (GPS System)

- üéØ **GPS Tracking**: Ger√ßek zamanlƒ± konum takibi
- üéØ **≈ûof√∂r Y√∂netimi**: ≈ûof√∂r profilleri, yetkilendirme
- üéØ **Sefer Takibi**: Seyahat ba≈ülangƒ±√ß/biti≈ü, duraklar
- üéØ **Mobil App Data**: Uygulama i√ßin √∂zelle≈ütirilmi≈ü veri

### Baƒülantƒ± Noktasƒ±: ilan_no

- **Primary Key**: ƒ∞ki Supabase project arasƒ±ndaki tek baƒülantƒ± noktasƒ±
- **Unique Constraint**: Her ilan numarasƒ± benzersiz
- **Data Sync**: Supabase #1'den Supabase #2'ye Edge Function calls ile veri aktarƒ±mƒ±

---

## üîó Backend Entegrasyonu

### 1. Supabase-to-Supabase Integration

**CRITICAL**: Both systems use Supabase, not PHP. All communication via Edge Functions.

#### ƒ∞≈ü Akƒ±≈üƒ±

```text
1. ƒ∞lan Olu≈üturma (kargomarketing.com Supabase)
   ‚Üì
2. Teklif S√ºreci & Onay
   ‚Üì
3. Edge Function Call ‚Üí GPS Supabase System
   ‚Üì
4. GPS Backend'de G√∂rev Olu≈üturma
   ‚Üì
5. ≈ûof√∂r Atama (Admin Panel)
   ‚Üì
6. Mobil App'de G√∂rev G√∂r√ºnt√ºleme
   ‚Üì
7. GPS Tracking Ba≈ülangƒ±√ß
```

#### API Integration Points

**Outgoing (kargomarketing.com Supabase ‚Üí GPS Supabase):**

```typescript
// create-gps-job.ts Edge Function (kargomarketing.com Supabase)
const gpsResponse = await fetch('https://iawqwfbvbigtbvipddao.supabase.co/functions/v1/create-job', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    api_key: "production_api_key_12345",
    ilan_no: "KRG2025001",
    customer_info: {
      name: "ABC Lojistik",
      phone: "+90 555 123 4567",
      email: "contact@abc.com"
    },
    delivery_address: {
      city: "ƒ∞stanbul",
      district: "Kadƒ±k√∂y", 
      full_address: "... detaylƒ± adres ..."
    },
    priority: "urgent",
    cargo_type: "electronics",
    deadline: "2025-08-15T18:00:00Z"
  })
})
```

**Incoming (GPS Supabase ‚Üí kargomarketing.com Supabase):**

```typescript
// webhook-handler.ts Edge Function (kargomarketing.com Supabase)
// Endpoints: driver-assigned, trip-started, trip-completed, location-update
serve(async (req: Request) => {
  const webhookData = await req.json()
  
  const supabaseKargo = createClient(
    Deno.env.get('KARGOMARKETING_SUPABASE_URL')!,
    Deno.env.get('KARGOMARKETING_SERVICE_KEY')!
  )
  
  await supabaseKargo.from('ilanlar').update({
    gps_status: webhookData.type,
    driver_name: webhookData.driver_name,
    gps_last_update: new Date().toISOString()
  }).eq('ilan_no', webhookData.ilan_no)
})
```

### 2. Supabase GPS Backend

#### Database Schema
```sql
-- Temel tablolar
gorevler          -- ƒ∞≈ü emirleri/g√∂revler
soforler          -- ≈ûof√∂r bilgileri  
konum_gecmisi     -- GPS tracking data
sefer_detaylari   -- Seyahat detaylarƒ±

-- Yeni entegrasyon kolonlarƒ±
priority          -- normal/urgent/critical
deadline          -- Son teslim tarihi
cargo_type        -- Kargo tipi
cargo_owner       -- Kargo sahibi
customer_info     -- M√º≈üteri JSON bilgileri
delivery_address  -- Teslimat adresi JSON
driver_approved   -- ≈ûof√∂r onay durumu
driver_notes      -- ≈ûof√∂r notlarƒ±
```

---

## üíª Teknik Altyapƒ±

### Frontend Stack
- **Framework**: React Native (Expo)
- **Language**: TypeScript
- **State Management**: React Hooks + Context
- **Navigation**: React Navigation v6
- **Location**: Expo Location API
- **HTTP Client**: Fetch API
- **Authentication**: Supabase Auth

### Backend Stack (Supabase)
- **Database**: PostgreSQL + PostGIS
- **Real-time**: Supabase Realtime
- **Authentication**: Supabase Auth (RLS)
- **Edge Functions**: Deno Runtime
- **File Storage**: Supabase Storage (future)

### API Architecture
- **RESTful**: Edge Functions as API Gateway
- **WebHooks**: Event-driven communication
- **CORS**: Cross-origin resource sharing enabled
- **Rate Limiting**: Built-in Supabase protection

### Security
```typescript
// Row Level Security (RLS) Policies
CREATE POLICY "soforler_own_data" 
ON gorevler FOR ALL 
USING (auth.uid() = sofor_id);

CREATE POLICY "admin_full_access" 
ON gorevler FOR ALL 
USING (auth.role() = 'admin');
```

---

## ‚öôÔ∏è Kurulum ve Yapƒ±landƒ±rma

### 1. React Native Mobil App

#### Prerequisites
```bash
# Node.js 18+ gerekli
node --version  # v18.0.0+

# Expo CLI global kurulum
npm install -g @expo/cli

# Git clone
git clone <repository>
cd gps-sefer
```

#### Dependencies Installation
```bash
# Ana dependencies
npm install

# React Navigation
npm install @react-navigation/native @react-navigation/stack
npm install react-native-screens react-native-safe-area-context

# Platform specific
npx expo install expo-location expo-constants

# Supabase client
npm install @supabase/supabase-js
```

#### Environment Configuration
```typescript
// config/supabase.ts
export const supabaseConfig = {
  url: 'https://iawqwfbvbigtbvipddao.supabase.co',
  anonKey: 'your_anon_key_here',
  apiKey: 'your_service_role_key_here'
}
```

### 2. Supabase Backend Setup

#### Database Initialization
```bash
# SQL files to run in order:
1. supabase-setup.sql          # Base schema
2. backend-integration-update.sql  # Integration columns
```

#### Edge Functions Deployment

**Manual Deployment (Supabase Dashboard):**
1. Project ‚Üí Edge Functions ‚Üí "Deploy new function"
2. Function isimleri:
   - `create-job`
   - `assign-driver` 
   - `get-tracking`
   - `driver-approve`

**Environment Variables:**
```env
BACKEND_1_API_KEY=production_api_key_here
BACKEND_1_WEBHOOK_URL=https://kargomarketing.com/api/webhook
SUPABASE_URL=https://iawqwfbvbigtbvipddao.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

### 3. Integration with kargomarketing.com

#### Required Endpoints (kargomarketing.com side)
```php
// POST /api/gps/create-job
// ƒ∞lan onaylandƒ±ƒüƒ±nda otomatik √ßaƒürƒ±lacak
function createGPSJob($ilan_data) {
    $endpoint = 'https://iawqwfbvbigtbvipddao.supabase.co/functions/v1/create-job';
    $data = [
        'api_key' => 'production_api_key',
        'ilan_no' => $ilan_data['ilan_no'],
        'customer_info' => $ilan_data['customer'],
        'delivery_address' => $ilan_data['address'],
        'priority' => $ilan_data['priority'] ?? 'normal'
    ];
    
    return $this->httpClient->post($endpoint, $data);
}

// POST /webhook/driver-assigned
// ≈ûof√∂r atandƒ±ƒüƒ±nda bildirim alacak
function handleDriverAssigned($webhook_data) {
    $ilan_no = $webhook_data['ilan_no'];
    $driver_id = $webhook_data['driver_id'];
    
    // kargomarketing.com veritabanƒ±nda g√ºncelle
    $this->updateIlanStatus($ilan_no, 'driver_assigned');
}
```

---

## üìö API Dok√ºmantasyonu

### Edge Functions API

#### 1. create-job
**Purpose**: Backend #1'den yeni g√∂rev olu≈üturma

```typescript
POST /functions/v1/create-job
Content-Type: application/json

Request:
{
  "api_key": "production_api_key",
  "ilan_no": "KRG2025001",
  "customer_info": {
    "name": "Test M√º≈üteri",
    "phone": "+90 555 123 4567"
  },
  "delivery_address": {
    "city": "ƒ∞stanbul",
    "full_address": "Test Adres"
  },
  "priority": "urgent",
  "cargo_type": "electronics"
}

Response:
{
  "success": true,
  "job_id": 123,
  "ilan_no": "KRG2025001",
  "status": "atanmamis",
  "message": "Job created successfully"
}
```

#### 2. assign-driver
**Purpose**: Admin panelinden ≈üof√∂r atama

```typescript
POST /functions/v1/assign-driver
Content-Type: application/json

Request:
{
  "job_id": 123,
  "driver_id": "user_uuid",
  "admin_user_id": "admin_uuid"
}

Response:
{
  "success": true,
  "job_id": 123,
  "ilan_no": "KRG2025001",
  "driver_id": "user_uuid",
  "status": "atandi"
}
```

#### 3. driver-approve
**Purpose**: Mobil uygulamadan ≈üof√∂r onayƒ±

```typescript
POST /functions/v1/driver-approve
Content-Type: application/json

Request:
{
  "job_id": 123,
  "driver_id": "user_uuid",
  "approve": true,
  "driver_notes": "ƒ∞steƒüe baƒülƒ± not"
}

Response:
{
  "success": true,
  "job_id": 123,
  "status": "onaylandi",
  "approved": true
}
```

#### 4. get-tracking
**Purpose**: Backend #1'den GPS verisi √ßekme

```typescript
POST /functions/v1/get-tracking
Content-Type: application/json

Request:
{
  "ilan_no": "KRG2025001",
  "api_key": "production_api_key"
}

Response:
{
  "success": true,
  "ilan_no": "KRG2025001",
  "status": "devam_ediyor",
  "tracking_data": {
    "last_location": {
      "lat": 40.217,
      "lon": 28.944,
      "timestamp": "2025-08-11T15:30:00Z"
    },
    "location_history": [...],
    "total_points": 25
  }
}
```

### Mobil App APIs

#### Internal RPC Functions
```typescript
// Aktif g√∂revleri getir
const { data } = await supabase.rpc('get_active_gorevler', {
  p_sofor_id: currentUser.id
});

// Konum g√ºncelle  
const { data } = await supabase.rpc('update_konum', {
  p_gorev_id: taskId,
  p_lat: latitude,
  p_lng: longitude
});
```

---

## üì± Mobil Uygulama

### Ana √ñzellikler

#### 1. Authentication
```typescript
// Supabase Auth ile giri≈ü
const signIn = async (email: string, password: string) => {
  const { data, error } = await supabase.auth.signInWithPassword({
    email,
    password
  });
  return { data, error };
};
```

#### 2. GPS Tracking
```typescript
// Konum takibi (5 saniye interval)
const startTracking = async () => {
  const locationSubscription = await Location.watchPositionAsync(
    {
      accuracy: Location.Accuracy.BestForNavigation,
      timeInterval: 5000,
      distanceInterval: 10
    },
    (location) => {
      updateLocationInDB(location.coords);
    }
  );
};
```

#### 3. Task Management
```typescript
// G√∂rev onaylama
const approveTask = async (taskId: string, approved: boolean) => {
  const response = await fetch(`${API_BASE}/driver-approve`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      job_id: taskId,
      driver_id: user.id,
      approve: approved
    })
  });
};
```

### Screen Architecture
```
App.tsx
‚îú‚îÄ‚îÄ AuthScreen.tsx          # Giri≈ü/Kayƒ±t
‚îú‚îÄ‚îÄ DashboardScreen.tsx     # Ana panel
‚îú‚îÄ‚îÄ TaskListScreen.tsx      # G√∂rev listesi
‚îú‚îÄ‚îÄ TaskDetailScreen.tsx    # G√∂rev detayƒ±
‚îú‚îÄ‚îÄ TrackingScreen.tsx      # GPS takip
‚îî‚îÄ‚îÄ ProfileScreen.tsx       # Profil ayarlarƒ±
```

### Navigation Structure
```typescript
// React Navigation v6
const Stack = createStackNavigator();

export default function App() {
  return (
    <NavigationContainer>
      <Stack.Navigator>
        <Stack.Screen name="Auth" component={AuthScreen} />
        <Stack.Screen name="Dashboard" component={DashboardScreen} />
        <Stack.Screen name="TaskDetail" component={TaskDetailScreen} />
      </Stack.Navigator>
    </NavigationContainer>
  );
}
```

---

## üöÄ Deployment Rehberi

### 1. Mobil App Deployment

#### Development
```bash
# Expo development server
cd gps-sefer
npx expo start

# Platform specific
npx expo start --android
npx expo start --ios
npx expo start --web
```

#### Production Build
```bash
# EAS Build (recommended)
npm install -g @expo/eas-cli
eas login
eas build --platform android
eas build --platform ios

# Classic build
expo build:android
expo build:ios
```

### 2. Supabase Deployment

#### Edge Functions
```bash
# Supabase CLI (if available)
supabase functions deploy create-job
supabase functions deploy assign-driver
supabase functions deploy get-tracking
supabase functions deploy driver-approve

# Manual deployment via Dashboard
# Project ‚Üí Edge Functions ‚Üí Deploy new function
```

#### Database Migrations
```sql
-- Run in Supabase SQL Editor
-- 1. supabase-setup.sql
-- 2. backend-integration-update.sql
-- 3. Any additional migrations
```

### 3. kargomarketing.com Integration

#### API Integration Points
```php
// config/gps_config.php
return [
    'supabase_url' => 'https://iawqwfbvbigtbvipddao.supabase.co',
    'api_key' => env('GPS_API_KEY'),
    'webhook_secret' => env('GPS_WEBHOOK_SECRET'),
    'functions' => [
        'create_job' => '/functions/v1/create-job',
        'get_tracking' => '/functions/v1/get-tracking'
    ]
];
```

#### Webhook Setup
```php
// routes/api.php
Route::post('/webhook/gps/driver-assigned', [GPSController::class, 'driverAssigned']);
Route::post('/webhook/gps/trip-started', [GPSController::class, 'tripStarted']);
Route::post('/webhook/gps/trip-completed', [GPSController::class, 'tripCompleted']);
```

---

## üîß Troubleshooting

### Common Issues

#### 1. Location Permission Errors
```typescript
// Solution: Request permissions properly
const requestLocationPermission = async () => {
  const { status } = await Location.requestForegroundPermissionsAsync();
  if (status !== 'granted') {
    Alert.alert('Permission Required', 'Location permission needed for GPS tracking');
    return false;
  }
  return true;
};
```

#### 2. Supabase Connection Issues
```typescript
// Solution: Check environment variables
const checkSupabaseConnection = async () => {
  try {
    const { data, error } = await supabase.from('gorevler').select('count');
    if (error) throw error;
    console.log('Supabase connected successfully');
  } catch (error) {
    console.error('Supabase connection failed:', error);
  }
};
```

#### 3. Edge Function Deployment Issues
```bash
# Check function logs
supabase functions logs create-job

# Verify environment variables
# Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí Environment variables
```

#### 4. Backend Integration Issues
```php
// Debug API calls
$response = $this->httpClient->post($endpoint, $data);
Log::info('GPS API Response:', $response);

// Check webhook delivery
Log::info('Webhook received:', $request->all());
```

### Performance Optimization

#### 1. Location Tracking
```typescript
// Optimize GPS frequency based on speed
const getTrackingInterval = (speed: number) => {
  if (speed > 50) return 3000;  // Highway: 3 seconds
  if (speed > 20) return 5000;  // City: 5 seconds
  return 10000;                 // Slow/stopped: 10 seconds
};
```

#### 2. Database Queries
```sql
-- Add indexes for better performance
CREATE INDEX idx_gorevler_sofor_id ON gorevler(sofor_id);
CREATE INDEX idx_gorevler_ilan_no ON gorevler(ilan_no);
CREATE INDEX idx_gorevler_created_at ON gorevler(created_at);
```

#### 3. API Rate Limiting
```typescript
// Implement request throttling
const throttledApiCall = throttle(apiCall, 1000); // Max 1 call per second
```

---

## üìû Support & Maintenance

### Development Team Contacts
- **Backend Developer**: [Backend integration lead]
- **Mobile Developer**: [React Native lead]
- **DevOps**: [Deployment and infrastructure]

### Production Monitoring
- **Supabase Dashboard**: Error logs, performance metrics
- **Expo Application Services**: Build status, crash reports
- **kargomarketing.com Logs**: Integration status, webhook delivery

### Version Control
```bash
# Git workflow
git checkout -b feature/new-functionality
git commit -m "feat: add new tracking feature"
git push origin feature/new-functionality
# Create Pull Request
```

---

## üìù Changelog

### v1.0.0 (Current)
- ‚úÖ React Native base app with GPS tracking
- ‚úÖ Supabase backend with PostgreSQL + PostGIS
- ‚úÖ Edge Functions for API gateway
- ‚úÖ Backend integration architecture
- ‚úÖ Task management system
- ‚úÖ Real-time location updates

### v1.1.0 (Planned)
- üîÆ Push notifications
- üîÆ Offline mode support
- üîÆ Advanced route optimization
- üîÆ Photo upload for delivery proof
- üîÆ Driver performance analytics

---

## üéØ Next Steps for Integration

### kargomarketing.com Integration Checklist

#### Phase 1: API Integration
- [ ] ƒ∞lan onayƒ± sonrasƒ± otomatik GPS g√∂rev olu≈üturma
- [ ] Webhook endpoints implement etme
- [ ] API authentication setup
- [ ] Error handling ve logging

#### Phase 2: UI Integration  
- [ ] Admin panel'de GPS tracking widget
- [ ] M√º≈üteri portal'da canlƒ± takip
- [ ] ≈ûof√∂r durumu g√∂stergesi
- [ ] Delivery proof display

#### Phase 3: Advanced Features
- [ ] Route optimization integration
- [ ] Automated ETA calculations
- [ ] Customer notification system
- [ ] Reporting dashboard

---

**Bu rehber, GPS Sefer Takip Sistemi'nin t√ºm teknik detaylarƒ±nƒ± ve entegrasyon s√ºrecini kapsamaktadƒ±r. Gelecekteki geli≈ütirmeler ve bakƒ±m i≈ülemleri i√ßin referans dok√ºman olarak kullanƒ±labilir.**
